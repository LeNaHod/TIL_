SQLD_TIL DAY01(22_10_02~22_10_03)

# 성능 데이터모델링에 대하여 알아보자

성능향상을 목적으로 **설계단계**의 데이터 모델링 때 부터 **성능과 관련된 사항**이 반영될수있도록 하는것이다.
문제가 생긴 SQL중심으로 집중튜닝하는 일 등은 성능 데이터모델링과 상관이없다.

- 성능 데이터 모델링의 특징
   성능 데이터 모델은 개발하는것에 따라 여러 데이터 모델링을 적용하여 시험해봐야하기때문에,
   성능을 튜닝하면서 계속 변경될 수 있다.


- 성능 데이터모델링의 순서와 고려사항
  
    1. 데이터모델링 할때 '정규화'를 정확하게 수행
    2. 용량산정
    3. 트랜잭션 유형파악
    4. 용량/트랜잭션의 유형에 따라 반정규화 수행
    5. 이력모델 조정, PK/FK 조정, 슈퍼/서브타입 조정 수행
    6. **성능관점**에서 모델검증

- 반정규화란?
    1. 정규화된 데이터모델을 '성능'을 중심으로 성능의 향상, 개발과정,편의성, 운영의 단순화 목적으로 수행되는
    의도적 정규화 원칙 위배행위(데이터 모델을 중복,병합,분리하는 과정을 말한다.)
    즉, 성능 테스트와 비슷한 느낌이다. 용량과 트랜잭션에 따라 성능을 테스트하는.

    2. 디스크 I/O,테이블끼리 경로가 멀거나,컬럼 계산시 조회 성능이 저하될것이 예상 될때 반정규화를 수행한다.
    3. 업무적으로 조회에 대한 처리성능이 중요할때 부분적으로 반정규화흫 수행한다
    4. 설계단계에서 적용하며, 미수행시에 성능이 저하된 데이터베이스가생성됨 / 구축단계나 시험단계에서 보다 반정규화를 적용시 노력,비용이 많이든다.

- 반정규화의 고려대상
    1. 집계 테이블 외에도 다양한 유형에 대해 반정규화를 할 수있다.
    2. RDBMS는 이전/이후 위치 레코드에 대한 탐색이 window function 으로 접근이 가능하다.
    3. 테이블에 대량데이터가 있고 대량의 범위를 자주 처리하는경우
    4. 통계성 프로세스에 의해 통계성 프로세스에 의해 통계정보를 필요로 할때 별도의 통계테이블 생성
    5. 자주사용되는 테이블에 엑세스하는 프로세스의 수가 많은 항상 일정한 범위만을 조회하는경우
    6. 테이블에 지나치게 많은 조인이 되어 조회가 기술적으로 어렵거나 성능이 저하 될 경우

-  정규화의 대상에 대해서 다른 방법으로 처리가능한지 검토
    1. 많은 조인을 하여 기술적으로 조회가 어려운경우 View 생성 ( 쿼리의 단순화 및 SQL 작성의 미숙함으로 인해 생기는 성능저하 방지)

    2. 대량 데이터 처리나 부분처리에 의해 성능저하되는 경우 클러스터링, 인덱스조정 등을 통해 성능 향상 도모

    3. PK에 성격에 따라 파티셔닝 기법을 적용

    4. 어플리케이션 단계의 로직을 구현 및 변경하는 방법으로 성능 향상.
     
**EX)**
   다량에 데이터를 탐색할 경우, 인덱스 X, 파티션 및 데이터클러스터링 등의 다양한 물리저장 기법을 활용해 성능 개선 유도가 가능하다. = But 인덱스를 사용한다고 무조건 성능저하는 아니다. 3번의 경우가 고려대상인것


- 반정규화의 적용
    반정규화 대상으로는 테이블, 속성, 관계에 대해 적용, 중복을 통한 방법만이 반정규화가 아니며
    테이블, 속성, 관계를 추가,분할,제거 할 수 있다.


- 반정규화 기법
    - 테이블 반정규화 기법

        ![테이블반정규화기법](https://dataonair.or.kr/publishing/img/knowledge/SQL_091.jpg)
    
    - 컬럼 반정규화 기법
     
        ![컬럼반정규화기법](https://dataonair.or.kr/publishing/img/knowledge/SQL_092.jpg)
    
    - 관계의 반정규화 기법

        ![관계반정규화기법](https://dataonair.or.kr/publishing/img/knowledge/SQL_093.jpg) 


- 하나의 테이블에서 자주 사용하는 컬럼들이 있을때 디스크의 I/O를 줄이기 위해 따로 컬럼을 모아두는것
  -> 태이블 반정규화-중복 테이블추가.

- 정규화에 대해 알아보자
    이상문제를 해결하기위해 속성들끼리 종속관계를 분석하여 여러개의 릴레이션으로 분해하는것이다.
    요러개로 분해하기때문에 다소 성능에 저하가 생길수있다.  But **중복을 제거함으로써 조회성능을 향상시킬 수 있음**
    정규화가 늘 성능을 저하시키는것은 아니다.
    
    정규화의 과정을 알아보자

    1. 제1 정규형 : 도메인은 모두 원자값이여야한다. 2가지가 들어가면 X. 컬럼단위의 중복,로우단위의 중복  모두 1차정규형 대상이다.
    ![1차정규형](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fk.kakaocdn.net%2Fdn%2FbIXuX0%2FbtqBGpEhISu%2FkNCOwnGlgcOJLMP43tiV6k%2Fimg.png)

    1. 제2  정규형 : 부분함수의 종속성을 제거한다.
 
        학번-학부,등록금,성적 / 과목코드-성적 

       -> 학번-학부,등록금 / 학번-과목코드,성적 

        위처럼 중복을 제거하는게 2차정규형이다.

    2. 제3 정규형 : 이행 함수종속을 제거한다.(이행규칙 : X → Y 이고 Y → Z 이면 X → Z 이다)

        학번(X),학부(Y)등록금(Z) 이면,
          학번-학부 / 학부-등록금 / 학번-과목코드-성적으로 나눠 이행함수 종속을 제거 한다.
    3. 제4 정규형 : 다치 종속 제거
    4. 제5 정규형 : 조인 종속성 제거
    5. BCNF : 결정자 중 후보키가 아닌것들은 제거

    **EX)**
        컬럼에의한 반복적인 속성값을 갖는 형태(도메인은 원자값을 가져야한다)는 제 1차 정규화'대상'이다.
        만약 1차 정규화 이전에 어느 하나의 속성이라도 인덱스가 정의되어있지 않으면, 전체 데이터를 스캔하기때문에
        성능저하가 일어날 수 있다. 그러니 1차 정규화를 실행한 후, 인덱스를 적용하는게 좋다.


- 이상문제란?
    크게 세가지로 나눌수있는데
    1. 삽입이상 : 데이터 저장시 불필요한 정보들도 같이 들어오는 경우
    2. 삭제이상 : 튜플을 삭제함으로써, 유지되어야하는 정보도 삭제되는 경우
    3. 갱신이상 : 중복된 튜플 중 일부 속성만 갱신시킴으로 모순이 발생하는 경우


- 함수의 종속성 
    함수적 종속은 어떠한 릴레이션에서 속성들의 부분 집합을 X, Y라 할 때 특정 튜플에서 X의 값이 Y의 값을 함수적으로 결정 한다면 Y가 X에 함수적으로 종속 되었다고 표현한다.
    
    함수의 종속성엔 추론규칙이있는데 다음은 아래와 같다.

    1. 재귀 규칙 : Y가 X의 부분 집합이면 X → Y 이다.
    2. 증가 규칙 : X → Y 이면 WX → WY 이고 WX → Y 이다.
    3. 이행 규칙 : X → Y 이고 Y → Z 이면 X → Z 이다.
    4. 유니온 규칙 : X → Y 이고 X → Z 이면 X → YZ 이다.
    5. 분해 규칙 : X → YZ 이면 X → Y와 X → Z 이다.
    6. 가이행 규칙 : 만일 W → X 이고 XY → Z 이면 WY → Z 이다.